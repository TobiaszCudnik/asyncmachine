!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n;"undefined"!=typeof window?n=window:"undefined"!=typeof global?n=global:"undefined"!=typeof self&&(n=self),n.asyncmachine=e()}}(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
var __extends=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},__indexOf=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},eventemitter=require("eventemitter3-abortable"),promise=require("es6-promise");exports.STATE_CHANGE={DROP:0,ADD:1,SET:2},exports.STATE_CHANGE_LABELS={0:"Drop",1:"Add",2:"Set"},exports.QUEUE={STATE_CHANGE:0,STATES:1,PARAMS:2,TARGET:3};var Deferred=function(){function t(){var t=this;this.promise=null,this.resolve=null,this.reject=null,this.promise=new promise.Promise(function(e,n){t.resolve=e,t.reject=n})}return t}();exports.Deferred=Deferred;var AsyncMachine=function(t){function e(e){t.call(this),this.states_all=null,this.states_active=null,this.queue=null,this.lock=!1,this.last_promise=null,this.log_handler_=null,this.debug_prefix="",this.debug_level=1,this.clock_={},this.internal_fields=[],this.target=null,this.transition_events=[],this.debug_=!1,this.Exception={},this.queue=[],this.states_all=[],this.states_active=[],this.clock_={},this.setTarget(e||this),this.register("Exception"),this.internal_fields=["_events","states_all","states_active","queue","lock","last_promise","log_handler_","debug_prefix","debug_level","clock_","debug_","target","internal_fields"]}return __extends(e,t),e.prototype.Exception_state=function(t,e,n){return null!=n.length&&this.log("Exception when tried to set following states: "+n.join(", ")),this.setImmediate(function(){throw e})},e.prototype.setTarget=function(t){return this.target=t},e.prototype.registerAll=function(){var t,n="",r=null;for(n in this)r=this[n],this.hasOwnProperty(n)&&__indexOf.call(this.internal_fields,n)<0&&this.register(n);var i=this.getInstance().constructor.prototype;for(t=[];;){for(n in i)r=i[n],i.hasOwnProperty(n)&&__indexOf.call(this.internal_fields,n)<0&&this.register(n);if(i=Object.getPrototypeOf(i),i===e.prototype)break;t.push(void 0)}return t},e.prototype.is=function(t,e){if(!t)return this.states_active;var n=!!~this.states_active.indexOf(t);return n?void 0===e?!0:this.clock(t)===e:!1},e.prototype.any=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n-0]=arguments[n];return e.some(function(e){return Array.isArray(e)?t.every(e):t.is(e)})},e.prototype.every=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n-0]=arguments[n];return e.every(function(e){return!!~t.states_active.indexOf(e)})},e.prototype.futureQueue=function(){return this.queue},e.prototype.register=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n-0]=arguments[n];return e.map(function(e){return t.states_all.push(e),t.clock_[e]=0})},e.prototype.get=function(t){return this[t]},e.prototype.set=function(t,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return t instanceof e?this.duringTransition()?(this.log("Queued SET state(s) "+n+" for an external machine",2),this.queue.push([exports.STATE_CHANGE.SET,n,r,t]),!0):t.add(n,r):(r=[n].concat(r),n=t,this.processStateChange_(exports.STATE_CHANGE.SET,n,r))},e.prototype.setByCallback=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return this.createCallback(this.createDeferred(this.set.bind(this),t,e,n))},e.prototype.setByListener=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return this.createListener(this.createDeferred(this.set.bind(this),t,e,n))},e.prototype.setNext=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=this.set.bind(this);return this.setImmediate(i,t,e,n)},e.prototype.add=function(t,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return t instanceof e?this.duringTransition()?(this.log("Queued ADD state(s) "+n+" for an external machine",2),this.queue.push([exports.STATE_CHANGE.ADD,n,r,t]),!0):t.add(n,r):(r=[n].concat(r),n=t,this.processStateChange_(exports.STATE_CHANGE.ADD,n,r))},e.prototype.addByCallback=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return this.createCallback(this.createDeferred(this.add.bind(this),t,e,n))},e.prototype.addByListener=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return this.createListener(this.createDeferred(this.add.bind(this),t,e,n))},e.prototype.addNext=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=this.add.bind(this);return this.setImmediate(i,t,e,n)},e.prototype.drop=function(t,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return t instanceof e?this.duringTransition()?(this.log("Queued DROP state(s) "+n+" for an external machine",2),this.queue.push([exports.STATE_CHANGE.DROP,n,r,t]),!0):t.drop(n,r):(r=[n].concat(r),n=t,this.processStateChange_(exports.STATE_CHANGE.DROP,n,r))},e.prototype.dropByCallback=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return this.createCallback(this.createDeferred(this.drop.bind(this),t,e,n))},e.prototype.dropByListener=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return this.createListener(this.createDeferred(this.drop.bind(this),t,e,n))},e.prototype.dropNext=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=this.drop.bind(this);return this.setImmediate(i,t,e,n)},e.prototype.pipeForward=function(t,n,r){var i=this;return t instanceof e?this.pipeForward(this.states_all,t,n):(this.log("Piping state "+t,3),[].concat(t).forEach(function(t){var e=r||t;return i.on(t+"_state",function(){return i.add(n,e)}),i.on(t+"_end",function(){return i.drop(n,e)})}))},e.prototype.pipeInvert=function(t,n,r){var i=this;return t instanceof e?this.pipeInvert(this.states_all,t,n):(this.log("Piping inverted state "+t,3),[].concat(t).forEach(function(t){var e=r||t;return i.on(t+"_state",function(){return i.drop(n,e)}),i.on(t+"_end",function(){return i.add(n,e)})}))},e.prototype.pipeOff=function(){throw new Error("not implemented yet")},e.prototype.clock=function(t){return this.clock_[t]},e.prototype.createChild=function(){var t=Object.create(this);return t.clock={},this.states_all.forEach(function(e){return t.clock[e]=0}),t},e.prototype.duringTransition=function(){return this.lock},e.prototype.getAbort=function(t,e){var n=this,r=this.clock(t);return function(){if(e&&!("function"==typeof e?e():void 0))var i=!0;return null==i&&(i=!n.is(t,r)),i&&n.log("Aborted "+t+" listener, while in states ("+n.is().join(", ")+")",1),i}},e.prototype.getAbortEnter=function(t,e){var n=this,r=this.clock(t);return function(){if(e&&!("function"==typeof e?e():void 0))var i=!0;return null==i&&(i=!n.is(t,r+1)),i&&n.log("Aborted "+t+"_enter listener, while in states "+("("+n.is().join(", ")+")"),1),i}},e.prototype.when=function(t,e){var n=this;return t=[].concat(t),new promise.Promise(function(r){return n.bindToStates(t,r,e)})},e.prototype.whenOnce=function(t,e){var n=this;return t=[].concat(t),new promise.Promise(function(r){return n.bindToStates(t,r,e,!0)})},e.prototype.debug=function(t,e){return void 0===t&&(t=""),void 0===e&&(e=1),this.debug_=!this.debug_,this.debug_prefix=t,this.debug_level=e,null},e.prototype.log=function(t,e){return null==e&&(e=1),!this.debug_||e>this.debug_level?void 0:console.log(this.debug_prefix+t)},e.prototype.on=function(e,n,r){return"_state"===e.slice(-6)&&this.is(e.slice(0,-6))&&n.call(r),t.prototype.on.call(this,e,n,r)},e.prototype.once=function(e,n,r){return"_state"===e.slice(-6)&&this.is(e.slice(0,-6))?n.call(r):t.prototype.once.call(this,e,n,r)},e.prototype.getInstance=function(){return this},e.prototype.setImmediate=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return setImmediate?setImmediate.apply(null,[t].concat(e)):setTimeout(t.apply(null,e),0)},e.prototype.processAutoStates=function(t){var e=this;null==t&&(t=[]);var n=[];return this.states_all.forEach(function(r){var i=function(){return~t.indexOf(r)},s=function(){return e.is(r)},o=function(){return e.is().some(function(t){return e.get(t).blocks?Boolean(~e.get(t).blocks.indexOf(r)):!1})};return!e[r].auto||i()||s()||o()?void 0:n.push(r)}),this.processStateChange_(exports.STATE_CHANGE.ADD,n,[],!0)},e.prototype.hasStateChanged=function(t){var e=this.is().length===t.length;return!e||this.diffStates(t,this.is()).length},e.prototype.processStateChange_=function(t,e,n,r,i){var s=this;if(e=[].concat(e),e=e.filter(function(t){return"string"!=typeof t?(s.log(t+" isnt a string (state name)"),!1):s.get(t)?!0:(s.log("State "+t+" doesnt exist"),!1)}),e.length){try{var o=exports.STATE_CHANGE_LABELS[t].toLowerCase();if(this.lock)return this.log("Queued "+o+" state(s) "+e.join(", "),2),void this.queue.push([t,e,n]);this.lock=!0;var a=this.queue;this.queue=[];var u=this.is();r?this.log("["+o+"] AUTO state "+e.join(", "),3):this.log("["+o+"] state "+e.join(", "),2);var c=this.selfTransitionExec_(e,n);if(c!==!1){var h=function(){switch(t){case exports.STATE_CHANGE.DROP:return this.states_active.filter(function(t){return!~e.indexOf(t)});case exports.STATE_CHANGE.ADD:return e.concat(this.states_active);case exports.STATE_CHANGE.SET:return e}}.call(this);if(h=this.setupTargetStates_(h),t!==exports.STATE_CHANGE.DROP&&!r){var l=e.every(function(t){return~h.indexOf(t)});l||(this.log("Cancelled the transition, as target states weren't accepted",3),c=!1)}}c!==!1&&(c=this.transition_(h,e,n)),this.queue=c===!1?a:a.concat(this.queue),this.lock=!1}catch(p){var f=p;return this.queue=a,this.lock=!1,void this.add("Exception",f,e)}return c!==!1&&this.hasStateChanged(u)&&this.processAutoStates(u),i||this.processQueue_(),t===exports.STATE_CHANGE.DROP?this.allStatesNotSet(e):this.allStatesSet(e)}},e.prototype.processQueue_=function(){for(var t=[],e=void 0;e=this.queue.shift();){var n=e[exports.QUEUE.TARGET]||this,r=[e[exports.QUEUE.STATE_CHANGE],e[exports.QUEUE.STATES],e[exports.QUEUE.PARAMS],!1,n===this||n.duringTransition()];t.push(n.processStateChange_.apply(n,r))}return!~t.indexOf(!1)},e.prototype.allStatesSet=function(t){var e=this;return t.every(function(t){return e.is(t)})},e.prototype.allStatesNotSet=function(t){var e=this;return t.every(function(t){return!e.is(t)})},e.prototype.createDeferred=function(t,e,n,r){var i=new Deferred;return i.promise.then(function(i){var s=[e];return n&&s.push(n),r.length&&s.push.apply(s,r),t.apply(null,s.concat(i))}),this.last_promise=i.promise,i},e.prototype.createCallback=function(t){var e=this;return function(n){void 0===n&&(n=null);for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];return n?(e.add("Exception",n),t.reject(n)):t.resolve(r)}},e.prototype.createListener=function(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n-0]=arguments[n];return t.resolve(e)}},e.prototype.selfTransitionExec_=function(t,e){var n=this;null==e&&(e=[]);var r=t.some(function(i){r=void 0;var s=i+"_"+i;if(~n.states_active.indexOf(i)){var o=[t].concat(e),a=n.getMethodContext(s);return a?(n.log("[transition] "+s,2),r=a[s].apply(a,o)):n.log("[transition] "+s,3),r===!1?(n.log("Self transition for "+i+" cancelled",2),!0):(r=n.emit.apply(n,[s].concat(e)),r!==!1&&n.transition_events.push([s,o]),r===!1)}});return!r},e.prototype.setupTargetStates_=function(t,e){var n=this;null==e&&(e=[]),t=t.filter(function(t){var e=~n.states_all.indexOf(t);return e||n.log("State "+t+" doesn't exist",2),Boolean(e)}),t=this.parseImplies_(t),t=this.removeDuplicateStates_(t);var r=[];return t=this.parseRequires_(t),t=t.reverse().filter(function(i){var s=n.isStateBlocked_(t,i);return s=s.filter(function(t){return!~r.indexOf(t)}),s.length&&(r.push(i),n.is(i)?n.log("State "+i+" dropped by "+s.join(", "),2):n.log("State "+i+" ignored because of "+s.join(", "),3)),!s.length&&!~e.indexOf(i)}),this.parseRequires_(t.reverse())},e.prototype.parseImplies_=function(t){var e=this;return t.forEach(function(n){var r=e.get(n);if(r.implies)return t=t.concat(r.implies)}),t},e.prototype.parseRequires_=function(t){for(var e=this,n=0,r={};n!==t.length;)n=t.length,t=t.filter(function(n){var i=e.get(n),s=[],o=!(null!=i.requires?i.requires.some(function(e){var n=~t.indexOf(e);return n||s.push(e),!n}):void 0);return s.length&&(r[n]=s),o});if(Object.keys(r).length){var i="",s=[],o=function(){var t;t=[];for(i in r)s=r[i],t.push(i+"(-"+s.join("-")+")");return t}();this.log("Can't set following states "+o.join(", ")+" ",2)}return t},e.prototype.removeDuplicateStates_=function(t){var e=[];return t.forEach(function(t){return~e.indexOf(t)?void 0:e.push(t)}),e},e.prototype.isStateBlocked_=function(t,e){var n=this,r=[];return t.forEach(function(t){var i=n.get(t);return i.blocks&&~i.blocks.indexOf(e)?r.push(t):void 0}),r},e.prototype.transition_=function(t,e,n){var r=this;null==n&&(n=[]),this.transition_events=[];var i=this.states_active.filter(function(e){return!~t.indexOf(e)});this.orderStates_(t),this.orderStates_(i);var s=i.some(function(i){return!1===r.transitionExit_(i,t,e,n)});return s===!0?!1:(s=t.some(function(i){if(~r.states_active.indexOf(i))return!1;if(~e.indexOf(i))var o=n;else o=[];return s=r.transitionEnter_(i,t,o),s===!1}),s===!0?!1:(this.setActiveStates_(t),!0))},e.prototype.setActiveStates_=function(t){var e=this,n=this.states_active,r=this.diffStates(t,this.states_active),i=this.diffStates(this.states_active,t),s=this.diffStates(t,r);this.states_active=t,t.forEach(function(t){return~n.indexOf(t)?void 0:e.clock_[t]++});var o=[];return r.length&&o.push("+"+r.join(" +")),i.length&&o.push("-"+i.join(" -")),s.length&&this.debug_level>2&&((r.length||i.length)&&o.push("\n    "),o.push(s.join(", "))),o.length&&this.log("[states] "+o.join(" "),1),this.processPostTransition(),this.emit("change",n)},e.prototype.processPostTransition=function(){var t,e=this;return this.transition_events.forEach(function(n){var r=n[0],i=n[1];if("_exit"===r.slice(-5))var s=r.slice(0,-5),o=s+"_end";else"_enter"===r.slice(-6)&&(s=r.slice(0,-6),o=s+"_state");var a=e.getMethodContext(o);return a?(e.log("[transition] "+s+"_end",2),null!=(t=a[o])&&t.apply(a,i)):e.log("[transition] "+s+"_end",3),e.emit.apply(e,[o].concat(i))}),this.transition_events=[]},e.prototype.getMethodContext=function(t){return this.target[t]?this.target:this[t]?this:void 0},e.prototype.diffStates=function(t,e){return t.filter(function(t){return __indexOf.call(e,t)<0}).map(function(t){return t})},e.prototype.transitionExit_=function(t,e,n,r){var i=this;if(~n.indexOf(t))var s=r;null==s&&(s=[]);var o=this.transitionExec_(t+"_exit",e,s);return o===!1?!1:(o=e.some(function(a){var u=t+"_"+a;return~n.indexOf(a)&&(s=r),null==s&&(s=[]),o=i.transitionExec_(u,e,s),o===!1}),o===!0?!1:(o=this.transitionExec_(t+"_any",e)===!1,!o))},e.prototype.transitionEnter_=function(t,e,n){var r=this.transitionExec_("any_"+t,e,n);return r===!1?!1:this.transitionExec_(t+"_enter",e,n)},e.prototype.transitionExec_=function(t,e,n){var r;null==n&&(n=[]);var i=[e].concat(n),s=void 0,o=this.getMethodContext(t);if(o?(this.log("[transition] "+t,2),s=null!=(r=o[t])&&"function"==typeof r.apply?r.apply(o,i):void 0):this.log("[transition] "+t,3),s!==!1){var a="_exit"===t.slice(-5),u=!a&&"_enter"===t.slice(-6);(a||u)&&this.transition_events.push([t,i]),s=this.emit(t,i),s===!1&&this.log("Cancelled transition to "+e.join(", ")+" by the event "+t,2)}else s===!1&&this.log("Cancelled transition to "+e.join(", ")+" by the method "+t,2);return s},e.prototype.orderStates_=function(t){var e=this;return t.sort(function(t,n){var r=e.get(t),i=e.get(n),s=0;return r.depends&&~r.depends.indexOf(n)?s=1:i.depends&&~i.depends.indexOf(t)&&(s=-1),s}),null},e.prototype.bindToStates=function(t,e,n,r){function i(){return o-=1}var s=this,o=0,a=function(){return o+=1,("function"==typeof n?n():void 0)||o!==t.length||e(),r||("function"==typeof n?n():void 0)?t.map(function(t){return s.removeListener(t+"_state",a),s.removeListener(t+"_end",i)}):void 0};return t.map(function(t){return s.log("Binding to event "+t,3),s.on(t+"_state",a),s.on(t+"_end",i)})},e}(eventemitter.EventEmitter);exports.AsyncMachine=AsyncMachine,module.exports.AsyncMachine=AsyncMachine;
},{"es6-promise":2,"eventemitter3-abortable":3}],2:[function(require,module,exports){
(function (process,global){
(function(){"use strict";function t(t){return"function"==typeof t||"object"==typeof t&&null!==t}function e(t){return"function"==typeof t}function n(t){return"object"==typeof t&&null!==t}function r(){}function o(){return function(){process.nextTick(c)}}function i(){var t=0,e=new F(c),n=document.createTextNode("");return e.observe(n,{characterData:!0}),function(){n.data=t=++t%2}}function s(){var t=new MessageChannel;return t.port1.onmessage=c,function(){t.port2.postMessage(0)}}function u(){return function(){setTimeout(c,1)}}function c(){for(var t=0;D>t;t+=2){var e=N[t],n=N[t+1];e(n),N[t]=void 0,N[t+1]=void 0}D=0}function a(){}function f(){return new TypeError("You cannot resolve a promise with itself")}function l(){return new TypeError("A promises callback cannot return that same promise.")}function h(t){try{return t.then}catch(e){return z.error=e,z}}function p(t,e,n,r){try{t.call(e,n,r)}catch(o){return o}}function _(t,e,n){Y(function(t){var r=!1,o=p(n,e,function(n){r||(r=!0,e!==n?m(t,n):w(t,n))},function(e){r||(r=!0,g(t,e))},"Settle: "+(t._label||" unknown promise"));!r&&o&&(r=!0,g(t,o))},t)}function d(t,e){e._state===W?w(t,e._result):t._state===q?g(t,e._result):b(e,void 0,function(e){m(t,e)},function(e){g(t,e)})}function v(t,n){if(n.constructor===t.constructor)d(t,n);else{var r=h(n);r===z?g(t,z.error):void 0===r?w(t,n):e(r)?_(t,n,r):w(t,n)}}function m(e,n){e===n?g(e,f()):t(n)?v(e,n):w(e,n)}function y(t){t._onerror&&t._onerror(t._result),A(t)}function w(t,e){t._state===U&&(t._result=e,t._state=W,0===t._subscribers.length||Y(A,t))}function g(t,e){t._state===U&&(t._state=q,t._result=e,Y(y,t))}function b(t,e,n,r){var o=t._subscribers,i=o.length;t._onerror=null,o[i]=e,o[i+W]=n,o[i+q]=r,0===i&&t._state&&Y(A,t)}function A(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var r,o,i=t._result,s=0;s<e.length;s+=3)r=e[s],o=e[s+n],r?P(n,r,o,i):o(i);t._subscribers.length=0}}function j(){this.error=null}function E(t,e){try{return t(e)}catch(n){return B.error=n,B}}function P(t,n,r,o){var i,s,u,c,a=e(r);if(a){if(i=E(r,o),i===B?(c=!0,s=i.error,i=null):u=!0,n===i)return void g(n,l())}else i=o,u=!0;n._state!==U||(a&&u?m(n,i):c?g(n,s):t===W?w(n,i):t===q&&g(n,i))}function T(t,e){try{e(function(e){m(t,e)},function(e){g(t,e)})}catch(n){g(t,n)}}function S(t,e,n,r){this._instanceConstructor=t,this.promise=new t(a,r),this._abortOnReject=n,this._validateInput(e)?(this._input=e,this.length=e.length,this._remaining=e.length,this._init(),0===this.length?w(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&w(this.promise,this._result))):g(this.promise,this._validationError())}function k(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function M(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function O(t){this._id=V++,this._state=void 0,this._result=void 0,this._subscribers=[],a!==t&&(e(t)||k(),this instanceof O||M(),T(this,t))}var C;C=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var R,x=C,D=(Date.now||function(){return(new Date).getTime()},Object.create||function(t){if(arguments.length>1)throw new Error("Second argument not supported");if("object"!=typeof t)throw new TypeError("Argument must be an object");return r.prototype=t,new r},0),Y=function(t,e){N[D]=t,N[D+1]=e,D+=2,2===D&&R()},I="undefined"!=typeof window?window:{},F=I.MutationObserver||I.WebKitMutationObserver,K="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,N=new Array(1e3);R="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?o():F?i():K?s():u();var U=void 0,W=1,q=2,z=new j,B=new j;S.prototype._validateInput=function(t){return x(t)},S.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},S.prototype._init=function(){this._result=new Array(this.length)};var G=S;S.prototype._enumerate=function(){for(var t=this.length,e=this.promise,n=this._input,r=0;e._state===U&&t>r;r++)this._eachEntry(n[r],r)},S.prototype._eachEntry=function(t,e){var r=this._instanceConstructor;n(t)?t.constructor===r&&t._state!==U?(t._onerror=null,this._settledAt(t._state,e,t._result)):this._willSettleAt(r.resolve(t),e):(this._remaining--,this._result[e]=this._makeResult(W,e,t))},S.prototype._settledAt=function(t,e,n){var r=this.promise;r._state===U&&(this._remaining--,this._abortOnReject&&t===q?g(r,n):this._result[e]=this._makeResult(t,e,n)),0===this._remaining&&w(r,this._result)},S.prototype._makeResult=function(t,e,n){return n},S.prototype._willSettleAt=function(t,e){var n=this;b(t,void 0,function(t){n._settledAt(W,e,t)},function(t){n._settledAt(q,e,t)})};var H=function(t,e){return new G(this,t,!0,e).promise},J=function(t,e){function n(t){m(i,t)}function r(t){g(i,t)}var o=this,i=new o(a,e);if(!x(t))return g(i,new TypeError("You must pass an array to race.")),i;for(var s=t.length,u=0;i._state===U&&s>u;u++)b(o.resolve(t[u]),void 0,n,r);return i},L=function(t,e){var n=this;if(t&&"object"==typeof t&&t.constructor===n)return t;var r=new n(a,e);return m(r,t),r},Q=function(t,e){var n=this,r=new n(a,e);return g(r,t),r},V=0,X=O;O.all=H,O.race=J,O.resolve=L,O.reject=Q,O.prototype={constructor:O,then:function(t,e){var n=this,r=n._state;if(r===W&&!t||r===q&&!e)return this;var o=new this.constructor(a),i=n._result;if(r){var s=arguments[r-1];Y(function(){P(r,o,s,i)})}else b(n,o,t,e);return o},"catch":function(t){return this.then(null,t)}};var Z=function(){var t;t="undefined"!=typeof global?global:"undefined"!=typeof window&&window.document?window:self;var n="Promise"in t&&"resolve"in t.Promise&&"reject"in t.Promise&&"all"in t.Promise&&"race"in t.Promise&&function(){var n;return new t.Promise(function(t){n=t}),e(n)}();n||(t.Promise=X)},$={Promise:X,polyfill:Z};"function"==typeof define&&define.amd?define(function(){return $}):"undefined"!=typeof module&&module.exports?module.exports=$:"undefined"!=typeof this&&(this.ES6Promise=$)}).call(this);
}).call(this,require('_process'),typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"_process":4}],3:[function(require,module,exports){
"use strict";function EE(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function EventEmitter(){}EventEmitter.prototype._events=void 0,EventEmitter.prototype.listeners=function(t){if(!this._events||!this._events[t])return[];if(this._events[t].fn)return[this._events[t].fn];for(var e=0,n=this._events[t].length,r=new Array(n);n>e;e++)r[e]=this._events[t][e].fn;return r},EventEmitter.prototype.emit=function(t,e,n,r,s,i){if(!this._events||!this._events[t])return!0;var v,o,h=this._events[t],E=arguments.length;if("function"==typeof h.fn){switch(h.once&&this.removeListener(t,h.fn,!0),E){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,e),!0;case 3:return h.fn.call(h.context,e,n),!0;case 4:return h.fn.call(h.context,e,n,r),!0;case 5:return h.fn.call(h.context,e,n,r,s),!0;case 6:return h.fn.call(h.context,e,n,r,s,i),!0}for(o=1,v=new Array(E-1);E>o;o++)v[o-1]=arguments[o];return h.fn.apply(h.context,v)}var c,f=h.length;for(h=[].concat(h),o=0;f>o;o++){h[o].once&&this.removeListener(t,h[o].fn,!0);var a;switch(E){case 1:a=h[o].fn.call(h[o].context);break;case 2:a=h[o].fn.call(h[o].context,e);break;case 3:a=h[o].fn.call(h[o].context,e,n);break;default:if(!v)for(c=1,v=new Array(E-1);E>c;c++)v[c-1]=arguments[c];a=h[o].fn.apply(h[o].context,v)}if(a===!1)return!1}return!0},EventEmitter.prototype.on=function(t,e,n){var r=new EE(e,n||this);return this._events||(this._events={}),this._events[t]?this._events[t].fn?this._events[t]=[this._events[t],r]:this._events[t].push(r):this._events[t]=r,this},EventEmitter.prototype.once=function(t,e,n){var r=new EE(e,n||this,!0);return this._events||(this._events={}),this._events[t]?this._events[t].fn?this._events[t]=[this._events[t],r]:this._events[t].push(r):this._events[t]=r,this},EventEmitter.prototype.removeListener=function(t,e,n){if(!this._events||!this._events[t])return this;var r=this._events[t],s=[];if(e&&(r.fn&&(r.fn!==e||n&&!r.once)&&s.push(r),!r.fn))for(var i=0,v=r.length;v>i;i++)(r[i].fn!==e||n&&!r[i].once)&&s.push(r[i]);return s.length?this._events[t]=1===s.length?s[0]:s:delete this._events[t],this},EventEmitter.prototype.removeAllListeners=function(t){return this._events?(t?delete this._events[t]:this._events={},this):this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prototype.setMaxListeners=function(){return this},EventEmitter.EventEmitter=EventEmitter,EventEmitter.EventEmitter2=EventEmitter,EventEmitter.EventEmitter3=EventEmitter,module.exports={EventEmitter:EventEmitter};
},{}],4:[function(require,module,exports){
function drainQueue(){if(!draining){draining=!0;for(var e,o=queue.length;o;){e=queue,queue=[];for(var r=-1;++r<o;)e[r]();o=queue.length}draining=!1}}function noop(){}var process=module.exports={},queue=[],draining=!1;process.nextTick=function(e){queue.push(e),draining||setTimeout(drainQueue,0)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(){throw new Error("process.chdir is not supported")},process.umask=function(){return 0};
},{}]},{},[1])(1)
});